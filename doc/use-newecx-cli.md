# Use newecx cli Command

Here is a snapshot of a project work directory:
<pre>
    .
    ├── data
    │   ├── inventory.csv
    │   └── ...
    ......
    ├── report
    │   ├── errors.csv
    │   ├── passed.csv
    │   ├── std-inventory.csv
    │   ├── summary.csv
    │   └── warnings.csv
    └── src
        ├── agreed-header.js
        └── fields-maps.js
</pre>

1. data/inventory.csv is your diamond feed. 

This should contain the diamonds available to sell. .

2. report folder contains reports.

Those reports are generated by newecx cli after running.

3. src/agreed-header.js contains your CSV headers. 

4. src/fields-maps.js contains the mapping info.

It maps from your headers and values to Ritani's standard format.

## Operations for newly started vendor:

Assuming you followed the quick start, 

1. you created a project directory, 
2. you changed your current work directory to the project directory, 
3. and you ran newecx --set-config to setup your credentials.

### Step 1 prepare inventory.csv

you can copy your latest inventory.csv to the data folder

OR

get the latest inventory feed that the server currently is holding

run

    newecx --download-inventory

### Step 2 agreed-header

run

    newecx --make-header

This will read your data/inventory.csv and extract the headers and save it in src/agreed-header.js

run

    newecx --upload-header

if your account is in production (out of sandbox), run

    newecx --force-upload-header

This will upload your headers (in src/agreed-header.js) to the server. This will serve as a contract between you and the API server. 
    
If you make any changes to the headers of the csv file, you will need to rerun these commands to update the server. Otherwise, your feed will be rejected.

### Step 3 fields-maps

run

    newecx --make-fields-maps

The cli generates src/fields-maps.js based on the headers and data in data/inventory.csv. 
    

It is a javascript object that defines:

1. How to map your CSV headers to Ritani standard keys? 

    This command will try to guess the mappings between your headers and the standard format. **YOU ARE RESPONSIBLE TO ENSURE THEY ARE CORRECT.**

2. How to map the values of the diamond characteristics to the standard values? 

    It provides a values_map object with the unknown values. You must provide the correct value mappings and then uncomment the block. See below.

### Step 3 modify fields-maps

Read through the fields-maps.js file and follow  the instructions provided within the file. Values that are unknown will be marked with a question mark ?. You will need to provide the mapping.

#### Tips:

##### 1) lab_grown

This field is for specifying whether the diamond is earth grown or lab grown. If your feed doesn't have a column for diamond type, you can simply add one line after the key: 'lab_grown':

<pre>
    default_value = 1 // for lab grown diamond

    OR

    default_value = 0 // for earth diamond
</pre>

##### 2) use default_value

For example, days_to_ship of all of diamonds is 1 day, you don't have to create a new column, instead you can simply add default_value = 1 to days_to_ship:

<pre>
    {
        key: 'days_to_ship',
        default_value = 1,
        ......
    },
</pre>

##### 3) values_map for shape and other keys

<pre>
    {
        key: 'shape',
        field: 'Shape',

    //  description: 'shape',
    //  require: 'required',
    //  type: 'string',

        values_map: {
            PC: 'PR',
            CC: 'CU'
        },
    
    //  allowed_values:: 'RD, CU, PR, EM, OV, AS, RA, MQ, PS, HS, TR, SH, PE, OC, ST, HE, HM, TZ',
    
    /*  for your reference:
    
        dictionary: {
        RD: 'Round',
        CU: 'Cushion',
        PR: 'Princess',
        EM: 'Emerald',
        OV: 'Oval',
        AS: 'Asscher',
        RA: 'Radiant',
        MQ: 'Marquise',
        PS: 'Pear',
        HS: 'Heart',
        TR: 'Triangle',
        SH: 'Shield',
        PE: 'Pentagonal',
        OC: 'Octagonal',
        ST: 'Star',
        HE: 'Hexagonal',
        HM: 'Half Moon',
        TZ: 'Trapezoid'
        }
    */
    },
</pre>

For the shape example above, you are expected to map all the shape code that will be used in your feed to Ritani's standard codes.

The sames is expected for other keys that have values_map.

##### 4) cost and cost_per_carat

You need to provide only one. If both are provided, the newecx cli checks the data integrity between them.

### Step 4 validate

run
    
    newecx --validate-inventory


Here is a sample output:

<pre>
    total diamonds: 583 passed count: 568
    
    summary report is saved to .../ritani-inventory/report/summary.csv
    passed diamonds report is saved to .../ritani-inventory/report/passed.csv
    errors report is saved to .../ritani-inventory/report/errors.csv
    warnings report is saved to .../ritani-inventory/report/warnings.csv
</pre>

1) report/summary.csv provides summary info:

<table>
   <tr>
   <th>total diamonds</th><th>passed count</th><th>errors count</th><th>warnings count</th><th>urls for certificate</th><th>urls for primary_image</th><th>urls for primary_video</th><th>urls for 3d_360</th><th>urls for cutprofile</th><th>urls for plot</th><th>urls for alternate_image</th><th>urls for alternate_video</th>
   </tr>
   <tr>
<td>583</td><td>568</td><td>15</td><td>1822</td><td>568</td><td>148</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
    </tr>
</table>


2) report/errors.csv lists the errors for the rejected diamonds:

<table>
<tr>
<th>row_no</th><th>vendor_sku</th><th>certificate_lab</th><th>certificate_number</th><th>field</th><th>type</th><th>message</th>
</tr>
<tr>
<td>1</td><td>467124161</td><td>IGI</td><td>LG467124161</td><td>Symmetry</td><td>error</td><td>missing required value, key symmetry</td>
</tr>
<tr>
<td>2</td><td>464118920</td><td>IGI</td><td>LG464118920</td><td>Symmetry</td><td>error</td><td>missing required value, key symmetry</td>
</tr>
<tr>
<td>13</td><td>472175898</td><td>IGI</td><td>LG472175898</td><td>Symmetry</td><td>error</td><td>missing required value, key symmetry</td>
</tr>
<tr>
</table>



3) report/warnings.csv provides recommendations to improve your feed:

<table>
<tr>
<th>row_no</th><th>vendor_sku</th><th>certificate_lab</th><th>certificate_number</th><th>field</th><th>type</th><th>message</th>
</tr>
<tr>
<td>1</td><td>467124161</td><td>IGI</td><td>LG467124161</td><td>days_to_ship</td><td>warning</td><td>value for days_to_ship is empty, but expected</td>
</tr>
<tr>
<td>1</td><td>467124161</td><td>IGI</td><td>LG467124161</td><td>Diamond Image</td><td>warning</td><td>value for orig_primary_image_url is empty, but expected</td>
</tr>
<tr>
<td>1</td><td>467124161</td><td>IGI</td><td>LG467124161</td><td>orig_video_url</td><td>warning</td><td>value for orig_video_url is empty, but expected</td>
</tr>
<tr>
<td>2</td><td>464118920</td><td>IGI</td><td>LG464118920</td><td>days_to_ship</td><td>warning</td><td>value for days_to_ship is empty, but expected</td>
</tr>
<tr>
<td>2</td><td>464118920</td><td>IGI</td><td>LG464118920</td><td>Diamond Image</td><td>warning</td><td>value for orig_primary_image_url is empty, but expected</td>
</tr>
<tr>
<td>2</td><td>464118920</td><td>IGI</td><td>LG464118920</td><td>orig_video_url</td><td>warning</td><td>value for orig_video_url is empty, but expected</td>
</tr>
</table>


4) report/passed.csv provides the list of passed diamonds

<table>
<tr>
<th>row_no</th><th>vendor_sku</th><th>certificate_lab</th><th>certificate_number</th><th>carat</th><th>cost</th><th>date_time</th><th>checksum</th>
</tr>
<tr>
<td>3</td><td>445046785</td><td>IGI</td><td>LG445046785</td><td>3.5</td><td>7892.5</td><td>2021-06-21T23:40:10.595Z</td><td>rKvhKoHnxsSe6wZVD7WpOYi7dvS</td>
</tr>
<tr>
<td>4</td><td>470130062</td><td>IGI</td><td>LG470130062</td><td>3.34</td><td>11573.1</td><td>2021-06-21T23:40:10.595Z</td><td>wDEczGlCsKRvd6DlL3KCKzVjDuf</td>
</tr>
<tr>
<td>5</td><td>474106655</td><td>IGI</td><td>LG474106655</td><td>3.32</td><td>9860.4</td><td>2021-06-21T23:40:10.595Z</td><td>w3E8505MPS07KlTfMdduMOY2GOd</td>
</table>


You may have to go through many iterations in order to perfect your feed (run Step3 and Step4, find the errors, make the necessary changes, run the steps again, and repeat until there are no errors).

### Step 5 upload the fields-maps to the API server

Once you have your fields-maps.js ready:

run
    
    newecx --upload-fields-maps

if your account is in production (out of sandbox), run

    newecx --force-upload-fields-maps

## Daily Operations:

### 1) copy your feed 

to project directory as data/inventory.csv

### 2) validate inventory

    newecx --validate-inventory

to see if your feeds are OK

### 3) submit inventory

Run one of the two operations, either one is OK

1)
    newecx --submit-inventory

to submit the original data/inventory.csv file to Ritani

2)
    newecx --submit-std-inventory

to submit the generated standardized report/std-inventory.csv file to Ritani